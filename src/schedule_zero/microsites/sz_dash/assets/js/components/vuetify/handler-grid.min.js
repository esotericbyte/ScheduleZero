import{g as $,p as _,x as A,a1 as R,v as L,a2 as p,r as M,w as f,s as b,u as O,a3 as y,q as x,k as D,A as j,a4 as B,c as N,V as l,b as m,e as h,a as z,h as s}from"../assets/main-B2pj_n4j.js";import{V as w,a as V,b as k,c as C}from"../assets/VSpacer-BdLXfRjN.js";const G=_({id:String,interactive:Boolean,text:String,...j(B({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:null}),["absolute","persistent"])},"VTooltip"),S=$()({name:"VTooltip",props:G(),emits:{"update:modelValue":t=>!0},setup(t,c){let{slots:r}=c;const i=A(t,"modelValue"),{scopeId:e}=R(),a=L(),n=p(()=>t.id||`v-tooltip-${a}`),o=M(),I=f(()=>t.location.split(" ").length>1?t.location:t.location+" center"),T=f(()=>t.origin==="auto"||t.origin==="overlap"||t.origin.split(" ").length>1||t.location.split(" ").length>1?t.origin:t.origin+" center"),P=p(()=>t.transition!=null?t.transition:i.value?"scale-transition":"fade-transition"),E=f(()=>b({"aria-describedby":n.value},t.activatorProps));return O(()=>{const H=y.filterProps(t);return x(y,b({ref:o,class:["v-tooltip",{"v-tooltip--interactive":t.interactive},t.class],style:t.style,id:n.value},H,{modelValue:i.value,"onUpdate:modelValue":u=>i.value=u,transition:P.value,absolute:!0,location:I.value,origin:T.value,persistent:!0,role:"tooltip",activatorProps:E.value,_disableGlobalStack:!0},e),{activator:r.activator,default:function(){var v;for(var u=arguments.length,g=new Array(u),d=0;d<u;d++)g[d]=arguments[d];return((v=r.default)==null?void 0:v.call(r,...g))??t.text}})}),D({},o)}});class U extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.app=null,this.refreshInterval=null}connectedCallback(){const c=this.getAttribute("api-endpoint")||"/api/handlers",r=document.createElement("div");this.shadow.appendChild(r);const i=N({components:{VDataTable:C,VBtn:h,VChip:m,VIcon:l,VTooltip:S,VToolbar:k,VToolbarTitle:V,VSpacer:w}});this.app=z({data(){return{handlers:[],loading:!0,headers:[{title:"Handler ID",key:"handler_id",sortable:!0},{title:"Address",key:"address",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Methods",key:"methods",sortable:!1},{title:"Last Seen",key:"last_seen",sortable:!0},{title:"Response Time",key:"response_time",sortable:!0},{title:"Actions",key:"actions",sortable:!1}]}},async mounted(){await this.fetchHandlers(),this.refreshInterval=setInterval(()=>this.fetchHandlers(),1e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchHandlers(){try{this.loading=!0;const e=await fetch(c);e.ok&&(this.handlers=await e.json())}catch(e){console.error("Error fetching handlers:",e)}finally{this.loading=!1}},getStatusColor(e){switch(e){case"online":return"success";case"offline":return"error";case"degraded":return"warning";default:return"grey"}},getResponseTimeColor(e){return e<100?"success":e<500?"warning":"error"},formatLastSeen(e){if(!e)return"Never";const a=Date.now()-new Date(e),n=Math.floor(a/6e4);if(n<1)return"Just now";if(n<60)return`${n}m ago`;const o=Math.floor(n/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`},async pingHandler(e){try{const a=await fetch(`${c}/${e.handler_id}/ping`,{method:"POST"});if(a.ok)this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"success",message:`Ping successful: ${e.handler_id}`},bubbles:!0}));else throw new Error(`HTTP ${a.status}`)}catch(a){this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"error",message:`Ping failed: ${a.message}`},bubbles:!0}))}},viewLogs(e){this.dispatchEvent(new CustomEvent("handler:view-logs",{detail:e,bubbles:!0}))}},render(){return s(C,{headers:this.headers,items:this.handlers,loading:this.loading,class:"elevation-1","item-value":"handler_id"},{top:()=>s(k,{flat:!0},[s(V,{},"Registered Handlers"),s(w),s(h,{icon:!0,onClick:()=>this.fetchHandlers()},()=>s(l,{},"mdi-refresh"))]),"item.status":({item:e})=>s(m,{color:this.getStatusColor(e.status),small:!0},()=>[s(l,{small:!0,left:!0},"mdi-circle"),e.status]),"item.methods":({item:e})=>s(S,{bottom:!0},{activator:({props:a})=>s("span",a,[e.methods?e.methods.slice(0,2).join(", "):"None",e.methods&&e.methods.length>2?s("span",{},`+${e.methods.length-2}`):null]),default:()=>e.methods?e.methods.join(", "):""}),"item.last_seen":({item:e})=>this.formatLastSeen(e.last_seen),"item.response_time":({item:e})=>e.response_time?s(m,{color:this.getResponseTimeColor(e.response_time),small:!0},()=>`${e.response_time}ms`):s("span",{},"-"),"item.actions":({item:e})=>[s(h,{icon:!0,small:!0,onClick:()=>this.pingHandler(e),class:"mr-2"},()=>s(l,{small:!0},"mdi-wifi")),s(h,{icon:!0,small:!0,onClick:()=>this.viewLogs(e)},()=>s(l,{small:!0},"mdi-file-document-outline"))]})}}),this.app.use(i).mount(r)}disconnectedCallback(){this.app&&this.app.unmount(),this.refreshInterval&&clearInterval(this.refreshInterval)}}customElements.define("handler-grid",U);
//# sourceMappingURL=handler-grid.min.js.map
