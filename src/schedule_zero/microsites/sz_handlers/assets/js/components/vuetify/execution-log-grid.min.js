import{g as N,p as H,x as U,a1 as J,r as j,P as z,a5 as K,O as w,u as M,a3 as V,s as E,q as k,k as W,a4 as $,a6 as q,U as C,a7 as I,a8 as G,c as Q,V as h,b,e as f,a as X,h as t}from"../assets/main-B2pj_n4j.js";import{V as x,a as T,b as D,c as P}from"../assets/VSpacer-BdLXfRjN.js";import{V as R,a as S,b as L,c as A}from"../assets/VCard-BEOKBIB5.js";const Y=H({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...$({origin:"center center",scrollStrategy:"block",transition:{component:q},zIndex:2400})},"VDialog"),F=N()({name:"VDialog",props:Y(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,v){let{emit:m,slots:c}=v;const d=U(s,"modelValue"),{scopeId:e}=J(),a=j();async function g(n){var r,u,i;const o=n.relatedTarget,l=n.target;await C(),d.value&&o!==l&&((r=a.value)!=null&&r.contentEl)&&((u=a.value)!=null&&u.globalTop)&&![document,a.value.contentEl].includes(l)&&!a.value.contentEl.contains(l)&&((i=I(a.value.contentEl)[0])==null||i.focus())}function p(n){var i;if(n.key!=="Tab"||!((i=a.value)!=null&&i.contentEl))return;const o=I(a.value.contentEl);if(!o.length)return;const l=o[0],r=o[o.length-1],u=document.activeElement;n.shiftKey&&u===l?(n.preventDefault(),r.focus()):!n.shiftKey&&u===r&&(n.preventDefault(),l.focus())}z(()=>{document.removeEventListener("focusin",g),document.removeEventListener("keydown",p)}),K&&w(()=>d.value&&s.retainFocus,n=>{n?(document.addEventListener("focusin",g,{once:!0}),document.addEventListener("keydown",p)):(document.removeEventListener("focusin",g),document.removeEventListener("keydown",p))},{immediate:!0});function B(){var n;m("afterEnter"),(s.scrim||s.retainFocus)&&((n=a.value)!=null&&n.contentEl)&&!a.value.contentEl.contains(document.activeElement)&&a.value.contentEl.focus({preventScroll:!0})}function O(){m("afterLeave")}return w(d,async n=>{var o;n||(await C(),(o=a.value.activatorEl)==null||o.focus({preventScroll:!0}))}),M(()=>{const n=V.filterProps(s),o=E({"aria-haspopup":"dialog"},s.activatorProps),l=E({tabindex:-1},s.contentProps);return k(V,E({ref:a,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},n,{modelValue:d.value,"onUpdate:modelValue":r=>d.value=r,"aria-modal":"true",activatorProps:o,contentProps:l,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:B,onAfterLeave:O},e),{activator:c.activator,default:function(){for(var r=arguments.length,u=new Array(r),i=0;i<r;i++)u[i]=arguments[i];return k(G,{root:"VDialog"},{default:()=>{var y;return[(y=c.default)==null?void 0:y.call(c,...u)]}})}})}),W({},a)}});class Z extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.app=null,this.refreshInterval=null}connectedCallback(){const v=this.getAttribute("api-endpoint")||"/api/executions",m=this.getAttribute("handler-id")||null,c=document.createElement("div");this.shadow.appendChild(c);const d=Q({components:{VDataTable:P,VBtn:f,VChip:b,VIcon:h,VDialog:F,VCard:A,VCardTitle:L,VCardText:S,VCardActions:R,VToolbar:D,VToolbarTitle:T,VSpacer:x}});this.app=X({data(){return{executions:[],loading:!0,dialog:!1,selectedExecution:null,headers:[{title:"Timestamp",key:"timestamp",sortable:!0},{title:"Job ID",key:"job_id",sortable:!0},{title:"Handler",key:"handler",sortable:!0},{title:"Method",key:"method",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Duration",key:"duration",sortable:!0},{title:"Result Preview",key:"result",sortable:!1},{title:"Actions",key:"actions",sortable:!1}]}},async mounted(){await this.fetchExecutions(),this.refreshInterval=setInterval(()=>this.fetchExecutions(),5e3)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchExecutions(){try{this.loading=!0;let e=v;m&&(e+=`?handler_id=${m}`);const a=await fetch(e);a.ok&&(this.executions=await a.json())}catch(e){console.error("Error fetching executions:",e)}finally{this.loading=!1}},getStatusColor(e){return e==="success"?"success":"error"},getDurationColor(e){return e<1e3?"success":e<5e3?"warning":"error"},formatTimestamp(e){return new Date(e).toLocaleString()},truncateResult(e){if(!e)return"No result";const a=typeof e=="string"?e:JSON.stringify(e);return a.length>100?a.substring(0,100)+"...":a},viewFullResult(e){this.selectedExecution=e,this.dialog=!0},async copyResult(e){try{const a=typeof e=="string"?e:JSON.stringify(e,null,2);await navigator.clipboard.writeText(a),this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"success",message:"Result copied to clipboard!"},bubbles:!0}))}catch{this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"error",message:"Failed to copy result"},bubbles:!0}))}},retryExecution(e){this.dispatchEvent(new CustomEvent("execution:retry",{detail:e,bubbles:!0}))}},render(){return t("div",{},[t(P,{headers:this.headers,items:this.executions,loading:this.loading,class:"elevation-1","item-value":"id"},{top:()=>t(D,{flat:!0},[t(T,{},"Execution History"),t(x),t(f,{icon:!0,onClick:()=>this.fetchExecutions()},()=>t(h,{},"mdi-refresh"))]),"item.timestamp":({item:e})=>this.formatTimestamp(e.timestamp),"item.status":({item:e})=>t(b,{color:this.getStatusColor(e.status),small:!0},()=>[t(h,{small:!0,left:!0},e.status==="success"?"mdi-check":"mdi-alert"),e.status]),"item.duration":({item:e})=>e.duration?t(b,{color:this.getDurationColor(e.duration),small:!0},()=>`${e.duration}ms`):null,"item.result":({item:e})=>this.truncateResult(e.result),"item.actions":({item:e})=>[t(f,{icon:!0,small:!0,onClick:()=>this.viewFullResult(e),class:"mr-2"},()=>t(h,{small:!0},"mdi-eye")),t(f,{icon:!0,small:!0,onClick:()=>this.copyResult(e.result),class:"mr-2"},()=>t(h,{small:!0},"mdi-content-copy")),e.status==="failure"?t(f,{icon:!0,small:!0,onClick:()=>this.retryExecution(e)},()=>t(h,{small:!0},"mdi-restart")):null].filter(Boolean)}),t(F,{"model-value":this.dialog,"onUpdate:model-value":e=>{this.dialog=e},"max-width":"800px"},()=>this.selectedExecution?t(A,{},[t(L,{},`Execution Result - ${this.selectedExecution.job_id}`),t(S,{},[t("pre",{style:"white-space: pre-wrap; background: #f5f5f5; padding: 16px; border-radius: 4px;"},typeof this.selectedExecution.result=="string"?this.selectedExecution.result:JSON.stringify(this.selectedExecution.result,null,2))]),t(R,{},[t(f,{onClick:()=>this.copyResult(this.selectedExecution.result)},"Copy"),t(x),t(f,{onClick:()=>{this.dialog=!1}},"Close")])]):null)])}}),this.app.use(d).mount(c)}disconnectedCallback(){this.app&&this.app.unmount(),this.refreshInterval&&clearInterval(this.refreshInterval)}}customElements.define("execution-log-grid",Z);
//# sourceMappingURL=execution-log-grid.min.js.map
