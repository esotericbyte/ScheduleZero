import{g as $,p as q,f as Fe,r as x,u as B,i as v,n as Ee,j as ge,k as X,m as Ae,l as Ne,o as Q,q as S,s as A,t as Te,v as Me,w as U,x as pe,y as be,z as G,I as le,A as He,B as ye,C as Ue,D as Oe,E as je,F as D,G as oe,H as ze,J as De,K as Ge,L as $e,M as qe,N as Be,O as E,P as Je,Q as re,R as se,S as We,T as Le,U as j,W as Ze,X as Ke,Y as ne,Z as Qe,_ as Xe,$ as Ye,c as et,e as ie,a0 as K,d as H,a as tt,h as r}from"../assets/main-B2pj_n4j.js";import{V as ue,a as de,b as ce,c as fe}from"../assets/VCard-BEOKBIB5.js";const at=q({...Ne(),...Ae()},"VForm"),me=$()({name:"VForm",props:at(),emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,d){let{slots:s,emit:n}=d;const o=Fe(e),t=x();function l(i){i.preventDefault(),o.reset()}function m(i){const h=i,c=o.validate();h.then=c.then.bind(c),h.catch=c.catch.bind(c),h.finally=c.finally.bind(c),n("submit",h),h.defaultPrevented||c.then(N=>{var f;let{valid:p}=N;p&&((f=t.value)==null||f.submit())}),h.preventDefault()}return B(()=>{var i;return v("form",{ref:t,class:ge(["v-form",e.class]),style:Ee(e.style),novalidate:!0,onReset:l,onSubmit:m},[(i=s.default)==null?void 0:i.call(s,o)])}),X(o,t)}}),lt=q({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),z=$()({name:"VRadio",props:lt(),setup(e,d){let{slots:s}=d;return B(()=>{const n=Q.filterProps(e);return S(Q,A(n,{class:["v-radio",e.class],style:e.style,type:"radio"}),s)}),{}}}),ot=q({height:{type:[Number,String],default:"auto"},...ye(),...He(Ue(),["multiple"]),trueIcon:{type:le,default:"$radioOn"},falseIcon:{type:le,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),he=$()({name:"VRadioGroup",inheritAttrs:!1,props:ot(),emits:{"update:modelValue":e=>!0},setup(e,d){let{attrs:s,slots:n}=d;const o=Me(),t=U(()=>e.id||`radio-group-${o}`),l=pe(e,"modelValue"),m=x();return B(()=>{const[i,h]=be(s),c=G.filterProps(e),N=Q.filterProps(e),p=n.label?n.label({label:e.label,props:{for:t.value}}):e.label;return S(G,A({ref:m,class:["v-radio-group",e.class],style:e.style},i,c,{modelValue:l.value,"onUpdate:modelValue":f=>l.value=f,id:t.value}),{...n,default:f=>{let{id:P,messagesId:b,isDisabled:T,isReadonly:J}=f;return v(D,null,[p&&S(Oe,{id:P.value},{default:()=>[p]}),S(je,A(N,{id:P.value,"aria-describedby":b.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:T.value,readonly:J.value,"aria-labelledby":p?P.value:void 0,multiple:!1},h,{modelValue:l.value,"onUpdate:modelValue":_=>l.value=_}),n)])}})}),X({},m)}}),rt=q({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Le(),...ye(),...We()},"VTextarea"),ve=$()({name:"VTextarea",directives:{vIntersect:oe},inheritAttrs:!1,props:rt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,d){let{attrs:s,emit:n,slots:o}=d;const t=pe(e,"modelValue"),{isFocused:l,focus:m,blur:i}=ze(e),{onIntersect:h}=Qe(e),c=U(()=>typeof e.counterValue=="function"?e.counterValue(t.value):(t.value||"").toString().length),N=U(()=>{if(s.maxlength)return s.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),p=x(),f=x(),P=De(""),b=x(),T=x(0),{platform:J}=Ge(),_=$e(e),Ve=U(()=>e.persistentPlaceholder||l.value||e.active);function W(){var a;_.isSuppressing.value&&_.update(),b.value!==document.activeElement&&((a=b.value)==null||a.focus()),l.value||m()}function xe(a){W(),n("click:control",a)}function we(a){n("mousedown:control",a)}function Ce(a){a.stopPropagation(),W(),j(()=>{t.value="",Ye(e["onClick:clear"],a)})}function Se(a){var F;const u=a.target;if(!((F=e.modelModifiers)!=null&&F.trim)){t.value=u.value;return}const g=u.value,k=u.selectionStart,w=u.selectionEnd;t.value=g,j(()=>{let C=0;g.trimStart().length===u.value.length&&(C=g.length-u.value.length),k!=null&&(u.selectionStart=k-C),w!=null&&(u.selectionEnd=w-C)})}const I=x(),M=x(Number(e.rows)),L=U(()=>["plain","underlined"].includes(e.variant));qe(()=>{e.autoGrow||(M.value=Number(e.rows))});function R(){j(()=>{if(!b.value)return;if(J.value.firefox){T.value=12;return}const{offsetWidth:a,clientWidth:u}=b.value;T.value=Math.max(0,a-u)}),e.autoGrow&&j(()=>{if(!I.value||!f.value)return;const a=getComputedStyle(I.value),u=getComputedStyle(f.value.$el),g=parseFloat(a.getPropertyValue("--v-field-padding-top"))+parseFloat(a.getPropertyValue("--v-input-padding-top"))+parseFloat(a.getPropertyValue("--v-field-padding-bottom")),k=I.value.scrollHeight,w=parseFloat(a.lineHeight),F=Math.max(parseFloat(e.rows)*w+g,parseFloat(u.getPropertyValue("--v-input-control-height"))),C=parseFloat(e.maxRows)*w+g||1/0,V=Ze(k??0,F,C);M.value=Math.floor((V-g)/w),P.value=se(V)})}Be(R),E(t,R),E(()=>e.rows,R),E(()=>e.maxRows,R),E(()=>e.density,R),E(M,a=>{n("update:rows",a)});let y;return E(I,a=>{a?(y=new ResizeObserver(R),y.observe(I.value)):y==null||y.disconnect()}),Je(()=>{y==null||y.disconnect()}),B(()=>{const a=!!(o.counter||e.counter||e.counterValue),u=!!(a||o.details),[g,k]=be(s),{modelValue:w,...F}=G.filterProps(e),C={...re.filterProps(e),"onClick:clear":Ce};return S(G,A({ref:p,modelValue:t.value,"onUpdate:modelValue":V=>t.value=V,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":L.value},e.class],style:[{"--v-textarea-scroll-bar-width":se(T.value)},e.style]},g,F,{centerAffix:M.value===1&&!L.value,focused:l.value}),{...o,default:V=>{let{id:O,isDisabled:Y,isDirty:ee,isReadonly:Pe,isValid:_e,hasDetails:Ie}=V;return S(re,A({ref:f,style:{"--v-textarea-control-height":P.value},onClick:xe,onMousedown:we,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},C,{id:O.value,active:Ve.value||ee.value,centerAffix:M.value===1&&!L.value,dirty:ee.value||e.dirty,disabled:Y.value,focused:l.value,details:Ie.value,error:_e.value===!1}),{...o,default:Re=>{let{props:{class:te,...ae},controlRef:ke}=Re;return v(D,null,[e.prefix&&v("span",{class:"v-text-field__prefix"},[e.prefix]),ne(v("textarea",A({ref:Z=>b.value=ke.value=Z,class:te,value:t.value,onInput:Se,autofocus:e.autofocus,readonly:Pe.value,disabled:Y.value,placeholder:e.placeholder,rows:e.rows,name:_.fieldName.value,autocomplete:_.fieldAutocomplete.value,onFocus:W,onBlur:i},ae,k),null),[[oe,{handler:h},null,{once:!0}]]),e.autoGrow&&ne(v("textarea",{class:ge([te,"v-textarea__sizer"]),id:`${ae.id}-sizer`,"onUpdate:modelValue":Z=>t.value=Z,ref:I,readonly:!0,"aria-hidden":"true"},null),[[Xe,t.value]]),e.suffix&&v("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:u?V=>{var O;return v(D,null,[(O=o.details)==null?void 0:O.call(o,V),a&&v(D,null,[v("span",null,null),S(Ke,{active:e.persistentCounter||l.value,value:c.value,max:N.value,disabled:e.disabled},o.counter)])])}:void 0})}),X({},p,f,b)}});class st extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.app=null}connectedCallback(){const d=this.getAttribute("schedule-id")||null,s=!!d,n=document.createElement("div");this.shadow.appendChild(n);const o=et({components:{VForm:me,VTextField:H,VSelect:K,VRadioGroup:he,VRadio:z,VBtn:ie,VCard:fe,VCardTitle:ce,VCardText:de,VCardActions:ue,VTextarea:ve}});this.app=tt({data(){return{valid:!1,loading:!1,handlers:[],selectedHandler:null,availableMethods:[],form:{job_id:"",handler:"",method:"",parameters:"{}",trigger_type:"interval",trigger_config:{interval_seconds:3600,cron_expression:"0 0 * * *",run_at:""}},rules:{required:t=>!!t||"Required",jobId:t=>/^[a-zA-Z0-9_-]+$/.test(t)||"Job ID must be alphanumeric with dashes/underscores only",json:t=>{try{return JSON.parse(t),!0}catch{return"Must be valid JSON"}}}}},async mounted(){await this.fetchHandlers(),s&&d&&await this.loadSchedule(d)},watch:{"form.handler"(t){this.selectedHandler=this.handlers.find(l=>l.handler_id===t),this.availableMethods=this.selectedHandler?this.selectedHandler.methods:[],this.availableMethods.length>0&&!this.availableMethods.includes(this.form.method)&&(this.form.method=this.availableMethods[0])}},methods:{async fetchHandlers(){try{const t=await fetch("/api/handlers");t.ok&&(this.handlers=await t.json())}catch(t){console.error("Error fetching handlers:",t)}},async loadSchedule(t){try{const l=await fetch(`/api/schedule/${t}`);if(l.ok){const m=await l.json();this.form={...this.form,...m},this.form.parameters=JSON.stringify(m.parameters||{},null,2)}}catch(l){console.error("Error loading schedule:",l)}},async saveSchedule(){if(this.valid){this.loading=!0;try{const t={...this.form,parameters:JSON.parse(this.form.parameters)},l=s?`/api/schedule/${d}`:"/api/schedule",i=await fetch(l,{method:s?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(i.ok)this.dispatchEvent(new CustomEvent("schedule-form:save",{detail:await i.json(),bubbles:!0})),this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"success",message:"Schedule saved successfully!"},bubbles:!0}));else throw new Error(`HTTP ${i.status}`)}catch(t){this.dispatchEvent(new CustomEvent("schedule-form:error",{detail:t,bubbles:!0})),this.dispatchEvent(new CustomEvent("sz:notify",{detail:{type:"error",message:`Save failed: ${t.message}`},bubbles:!0}))}finally{this.loading=!1}}}},render(){return r(fe,{},[r(ce,{},"Create/Edit Schedule"),r(de,{},[r(me,{"model-value":this.valid,"onUpdate:model-value":t=>{this.valid=t}},[r(H,{"model-value":this.form.job_id,"onUpdate:model-value":t=>{this.form.job_id=t},label:"Job ID",rules:[this.rules.required,this.rules.jobId],required:!0}),r(K,{"model-value":this.form.handler,"onUpdate:model-value":t=>{this.form.handler=t},items:this.handlers,"item-title":"handler_id","item-value":"handler_id",label:"Handler",rules:[this.rules.required],required:!0}),r(K,{"model-value":this.form.method,"onUpdate:model-value":t=>{this.form.method=t},items:this.availableMethods,label:"Method",rules:[this.rules.required],required:!0,disabled:!this.form.handler}),r(ve,{"model-value":this.form.parameters,"onUpdate:model-value":t=>{this.form.parameters=t},label:"Parameters (JSON)",rules:[this.rules.json],rows:4,"auto-grow":!0}),r(he,{"model-value":this.form.trigger_type,"onUpdate:model-value":t=>{this.form.trigger_type=t},label:"Trigger Type"},[r(z,{label:"Interval",value:"interval"}),r(z,{label:"Cron",value:"cron"}),r(z,{label:"Date/Time",value:"date"})]),...this.form.trigger_type==="interval"?[r(H,{"model-value":this.form.trigger_config.interval_seconds,"onUpdate:model-value":t=>{this.form.trigger_config.interval_seconds=Number(t)},label:"Interval (seconds)",type:"number",rules:[this.rules.required]})]:[],...this.form.trigger_type==="cron"?[r(H,{"model-value":this.form.trigger_config.cron_expression,"onUpdate:model-value":t=>{this.form.trigger_config.cron_expression=t},label:"Cron Expression",rules:[this.rules.required],hint:"e.g., 0 0 * * * (daily at midnight)"})]:[],...this.form.trigger_type==="date"?[r(H,{"model-value":this.form.trigger_config.run_at,"onUpdate:model-value":t=>{this.form.trigger_config.run_at=t},label:"Run At",type:"datetime-local",rules:[this.rules.required]})]:[]])]),r(ue,{},[r(ie,{onClick:()=>this.saveSchedule(),disabled:!this.valid,loading:this.loading,color:"primary"},"Save")])])}}),this.app.use(o).mount(n)}disconnectedCallback(){this.app&&this.app.unmount()}}customElements.define("schedule-form",st);
//# sourceMappingURL=schedule-form.min.js.map
