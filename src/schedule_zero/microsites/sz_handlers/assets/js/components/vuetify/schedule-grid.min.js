import{c as m,a as p,V as a,b as i,d as n,e as r,h as t}from"../assets/main-B2pj_n4j.js";import{V as o,a as h,b as c,c as d}from"../assets/VSpacer-BdLXfRjN.js";class b extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.app=null,this.refreshInterval=null}connectedCallback(){const u=this.getAttribute("api-endpoint")||"/api/schedules",l=document.createElement("div");this.shadow.appendChild(l);const f=m({components:{VDataTable:d,VBtn:r,VTextField:n,VChip:i,VIcon:a,VToolbar:c,VToolbarTitle:h,VSpacer:o}});this.app=p({data(){return{schedules:[],loading:!0,search:"",headers:[{title:"Job ID",key:"job_id",sortable:!0},{title:"Handler",key:"handler",sortable:!0},{title:"Method",key:"method",sortable:!0},{title:"Next Run",key:"next_run",sortable:!0},{title:"Trigger",key:"trigger_type",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Actions",key:"actions",sortable:!1}]}},async mounted(){await this.fetchSchedules(),this.refreshInterval=setInterval(()=>this.fetchSchedules(),3e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchSchedules(){try{this.loading=!0;const e=await fetch(u);e.ok?this.schedules=await e.json():console.error("Failed to fetch schedules:",e.status)}catch(e){console.error("Error fetching schedules:",e)}finally{this.loading=!1}},formatNextRun(e){if(!e)return"Not scheduled";const s=new Date(e)-new Date;return s<0?"Overdue":s<6e4?"In < 1 min":s<36e5?`In ${Math.floor(s/6e4)} min`:s<864e5?`In ${Math.floor(s/36e5)} hr`:`In ${Math.floor(s/864e5)} days`},getStatusColor(e){return e==="active"?"success":"warning"},editSchedule(e){this.dispatchEvent(new CustomEvent("schedule:edit",{detail:e,bubbles:!0}))},deleteSchedule(e){confirm(`Delete schedule ${e.job_id}?`)&&this.dispatchEvent(new CustomEvent("schedule:delete",{detail:e,bubbles:!0}))}},render(){return t(d,{headers:this.headers,items:this.schedules,loading:this.loading,search:this.search,class:"elevation-1","item-value":"job_id"},{top:()=>t(c,{flat:!0},[t(h,{},"Scheduled Jobs"),t(o),t(n,{"model-value":this.search,"onUpdate:model-value":e=>{this.search=e},"append-icon":"mdi-magnify",label:"Search","single-line":!0,"hide-details":!0,class:"ma-2",style:"max-width: 300px;"})]),"item.next_run":({item:e})=>this.formatNextRun(e.next_run),"item.status":({item:e})=>t(i,{color:this.getStatusColor(e.status),small:!0},()=>e.status),"item.actions":({item:e})=>[t(r,{icon:!0,small:!0,onClick:()=>this.editSchedule(e),class:"mr-2"},()=>t(a,{small:!0},"mdi-pencil")),t(r,{icon:!0,small:!0,color:"error",onClick:()=>this.deleteSchedule(e)},()=>t(a,{small:!0},"mdi-delete"))]})}}),this.app.use(f).mount(l)}disconnectedCallback(){this.app&&this.app.unmount(),this.refreshInterval&&clearInterval(this.refreshInterval)}}customElements.define("schedule-grid",b);
//# sourceMappingURL=schedule-grid.min.js.map
