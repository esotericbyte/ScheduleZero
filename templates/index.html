
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>{{ title }}</title><script src="https://cdn.tailwindcss.com"></script><style>body { font-family: 'Inter', sans-serif; } nav a.active { font-weight: bold; text-decoration: underline; } .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-left: 10px; vertical-align: middle;} @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; vertical-align: top; } th { background-color: #f2f2f2; } td pre { white-space: pre-wrap; word-break: break-all; max-height: 10em; overflow-y: auto; }</style><link rel="preconnect" href="https://rsms.me/"><link rel="stylesheet" href="https://rsms.me/inter/inter.css"></head><body class="bg-gray-100 text-gray-800"><div class="container mx-auto p-4"><header class="bg-blue-600 text-white p-4 rounded-lg shadow mb-6"><h1 class="text-2xl font-bold">{{ title }}</h1></header><nav class="bg-white p-3 rounded-lg shadow mb-6 flex space-x-4"><a href="#readme" class="text-blue-600 hover:text-blue-800">Home/Readme</a><a href="#about" class="text-blue-600 hover:text-blue-800">About</a><a href="#registrations" class="text-blue-600 hover:text-blue-800">Registrations</a><a href="#schedules" class="text-blue-600 hover:text-blue-800">Schedules</a></nav><main id="content" class="bg-white p-6 rounded-lg shadow min-h-[300px]"><p>Loading...</p></main><footer class="text-center text-gray-500 mt-6 text-sm">ScheduleZero - Powered by Tornado & APScheduler</footer></div><script> const contentEl=document.getElementById('content'),navLinks=document.querySelectorAll('nav a');let currentApiRequestController=null;async function fetchData(url){if(currentApiRequestController){try{currentApiRequestController.abort()}catch(e){console.warn("Could not abort previous request",e)}} currentApiRequestController=new AbortController();const signal=currentApiRequestController.signal;showLoading();try{const response=await fetch(url,{signal});if(!response.ok){let errorMsg=`HTTP error! Status: ${response.status}`;try{const errData=await response.json();errorMsg=errData?.error?.message||errorMsg}catch(e){} throw new Error(errorMsg)} return await response.json()}catch(error){if(error.name==='AbortError'){console.log('Fetch aborted');return null} console.error('Fetch error:',error);showError(`Failed to load data: ${error.message}`);return null}finally{if(signal===currentApiRequestController?.signal){currentApiRequestController=null}}} function showLoading(){contentEl.innerHTML='<p>Loading<span class="loader"></span></p>'} function showError(message){contentEl.innerHTML=`<p class="text-red-600 font-bold">Error:</p><p>${message}</p>`} function setActiveLink(hash){navLinks.forEach(link=>{if(link.getAttribute('href')===hash){link.classList.add('active')}else{link.classList.remove('active')}})} function escapeHtml(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")} function renderReadme(data){if(!data)return;contentEl.innerHTML=`<h2 class="text-xl font-semibold mb-4">README</h2><pre class="bg-gray-50 p-4 rounded border text-sm whitespace-pre-wrap">${escapeHtml(data.readme_content||'Failed to load README.')}</pre>`} function renderAbout(data){if(!data)return;let content='<h2 class="text-xl font-semibold mb-4">About This Instance</h2>';if(data.error){content+=`<p class="text-red-500">${escapeHtml(data.error)}</p>`}else{content+='<ul class="list-disc pl-5 space-y-1">';for(const key in data){content+=`<li><strong>${escapeHtml(key.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase()))}:</strong> ${escapeHtml(String(data[key]))}</li>`} content+='</ul>'} contentEl.innerHTML=content} function renderRegistrations(data){if(!data)return;let tableHtml='<h2 class="text-xl font-semibold mb-4">Registered Handlers</h2>';if(!data.handlers||data.handlers.length===0){tableHtml+='<p>No handlers are currently registered.</p>'}else{tableHtml+='<div class="overflow-x-auto"><table class="w-full min-w-[600px]"><thead><tr><th>ID</th><th>Address</th><th>Status</th><th>Methods</th></tr></thead><tbody>';data.handlers.forEach(h=>{tableHtml+=`<tr><td>${escapeHtml(h.id)}</td><td>${escapeHtml(h.address)}</td><td class="${h.status.startsWith('Connected')?'text-green-600':'text-red-600'}">${escapeHtml(h.status)}</td><td>${escapeHtml(h.methods.join(', '))}</td></tr>`});tableHtml+='</tbody></table></div>'} contentEl.innerHTML=tableHtml} function renderSchedules(data){if(!data)return;const{schedules,pagination}=data;let contentHtml=`<h2 class="text-xl font-semibold mb-4">Scheduled Jobs</h2><div class="mb-4 flex flex-wrap items-center gap-4"><div><label for="start_time" class="mr-2">Start (UTC):</label><input type="datetime-local" id="start_time" class="border rounded p-1"></div><div><label for="end_time" class="mr-2">End (UTC):</label><input type="datetime-local" id="end_time" class="border rounded p-1"></div><button id="filter_button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded">Filter List</button><span class="text-sm text-gray-600">(Default: Next 7 days)</span></div>`;if(!schedules||schedules.length===0){contentHtml+='<p>No schedules found matching the criteria.</p>'}else{contentHtml+=`<p class="text-sm mb-2">Showing ${pagination.offset+1}-${Math.min(pagination.offset+pagination.limit,pagination.total)} of ${pagination.total} schedules.</p><div class="overflow-x-auto"><table class="w-full text-sm min-w-[800px]"><thead><tr><th>ID</th><th>Next Fire Time (UTC)</th><th>Handler</th><th>Method</th><th>Params</th><th>Trigger</th><th>Status</th></tr></thead><tbody>`;schedules.forEach(s=>{const nextFire=s.next_fire_time?new Date(s.next_fire_time).toISOString().replace('T',' ').substring(0,19):'N/A';const status=s.paused?`Paused until ${new Date(s.paused_until).toISOString().substring(0,10)}`:'Active';contentHtml+=`<tr><td class="break-all">${escapeHtml(s.id)}</td><td>${escapeHtml(nextFire)}</td><td>${escapeHtml(s.handler_id)}</td><td>${escapeHtml(s.method_name)}</td><td><pre class="text-xs bg-gray-50 p-1 rounded">${escapeHtml(JSON.stringify(s.job_params,null,2))}</pre></td><td class="text-xs">${escapeHtml(s.trigger)}</td><td class="${s.paused?'text-orange-600':'text-green-600'}">${escapeHtml(status)}</td></tr>`});contentHtml+='</tbody></table></div>';contentHtml+='<div class="mt-4 flex justify-between items-center">';const canPrev=pagination.offset>0;const canNext=(pagination.offset+pagination.limit)<pagination.total;contentHtml+=`<button id="prev_page" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded ${!canPrev?'opacity-50 cursor-not-allowed':''}" ${!canPrev?'disabled':''}>&lt; Previous</button>`;contentHtml+=`<span class="text-sm">Page ${Math.floor(pagination.offset/pagination.limit)+1} of ${Math.ceil(pagination.total/pagination.limit)}</span>`;contentHtml+=`<button id="next_page" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded ${!canNext?'opacity-50 cursor-not-allowed':''}" ${!canNext?'disabled':''}>Next &gt;</button>`;contentHtml+='</div>'} contentEl.innerHTML=contentHtml;document.getElementById('filter_button')?.addEventListener('click',()=>loadSchedules(0));document.getElementById('prev_page')?.addEventListener('click',()=>loadSchedules(pagination.offset-pagination.limit));document.getElementById('next_page')?.addEventListener('click',()=>loadSchedules(pagination.offset+pagination.limit));const currentSearchParams=new URLSearchParams(window.location.search);const currentStartTime=currentSearchParams.get('start_time');const currentEndTime=currentSearchParams.get('end_time');const startInput=document.getElementById('start_time');const endInput=document.getElementById('end_time');if(startInput&&currentStartTime)startInput.value=localDatetimeFromISO(currentStartTime);if(endInput&&currentEndTime)endInput.value=localDatetimeFromISO(currentEndTime)} function localDatetimeFromISO(isoString){if(!isoString)return '';try{const date=new Date(isoString);if(isNaN(date.getTime()))return '';const offset=date.getTimezoneOffset()*60000;const localISOTime=(new Date(date.getTime()-offset)).toISOString().slice(0,16);return localISOTime}catch(e){console.error("Error parsing date for input:",e);return ''}} function isoStringFromLocalInput(elementId){const input=document.getElementById(elementId);if(!input||!input.value)return null;try{const localDate=new Date(input.value);if(isNaN(localDate.getTime()))return null;return localDate.toISOString()}catch(e){console.error("Error creating ISO string from input:",e);return null}} async function loadReadme(){const data=await fetchData('/api/readme');renderReadme(data)} async function loadAbout(){const data=await fetchData('/api/config');renderAbout(data)} async function loadRegistrations(){const data=await fetchData('/api/handlers');renderRegistrations(data)} async function loadSchedules(requestedOffset=0){const limitParam=new URLSearchParams(window.location.search).get('limit');const limit=parseInt(limitParam||'50',10);let offset=Math.max(0,requestedOffset);let startTimeISO=isoStringFromLocalInput('start_time');let endTimeISO=isoStringFromLocalInput('end_time');const params=new URLSearchParams(window.location.search);const navigatedFromOtherPage=!params.has('start_time')&&!params.has('end_time')&&!document.getElementById('start_time');if(navigatedFromOtherPage&&!startTimeISO&&!endTimeISO){const now=new Date();const nextWeek=new Date(now.getTime()+7*24*60*60*1000);startTimeISO=now.toISOString();endTimeISO=nextWeek.toISOString()} const url=new URL('/api/schedules',window.location.origin);url.searchParams.set('limit',limit);url.searchParams.set('offset',offset);if(startTimeISO)url.searchParams.set('start_time',startTimeISO);if(endTimeISO)url.searchParams.set('end_time',endTimeISO);const historyUrl=new URL(window.location);historyUrl.hash='#schedules';historyUrl.searchParams.set('limit',limit);historyUrl.searchParams.set('offset',offset);if(startTimeISO)historyUrl.searchParams.set('start_time',startTimeISO);else historyUrl.searchParams.delete('start_time');if(endTimeISO)historyUrl.searchParams.set('end_time',endTimeISO);else historyUrl.searchParams.delete('end_time');history.replaceState(null,'',historyUrl);const data=await fetchData(url.toString());renderSchedules(data)} function router(){const hash=window.location.hash||'#readme';setActiveLink(hash);switch(hash){case'#readme':loadReadme();break;case'#about':loadAbout();break;case'#registrations':loadRegistrations();break;case'#schedules':const params=new URLSearchParams(window.location.search);const offset=parseInt(params.get('offset')||'0',10);loadSchedules(offset);break;default:contentEl.innerHTML='<p>Page not found.</p>';setActiveLink('')}} window.addEventListener('hashchange',router);window.addEventListener('load',router); </script></body></html>
    